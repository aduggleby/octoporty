---
import BaseLayout from "../layouts/BaseLayout.astro";
import CodeBlock from "../components/CodeBlock.astro";

const quickStartGateway = `# SSH into your cloud server
ssh user@your-gateway-server.com

# Download and run the Gateway installer
# (prompts for domain, generates API key automatically)
curl -fsSL https://octoporty.com/install-gateway.sh | bash

# Start the Gateway
cd /opt/octoporty/gateway && docker compose up -d`;

const quickStartAgent = `# SSH into your private network server
ssh user@your-internal-server.com

# Download and run the Agent installer
# (prompts for Gateway URL and API key from Gateway install)
curl -fsSL https://octoporty.com/install-agent.sh | bash

# Start the Agent
cd /opt/octoporty/agent && docker compose up -d`;

const features = [
  { title: "Self-Hosted", desc: "Full control over your infrastructure. No third-party data exposure." },
  { title: "Automatic HTTPS", desc: "Caddy integration provides automatic TLS certificates via Let's Encrypt." },
  { title: "Web Dashboard", desc: "React-based UI for managing port mappings and monitoring connections." },
  { title: "Multi-Domain", desc: "Route multiple domains to different internal services through one tunnel." },
  { title: "Auto-Reconnect", desc: "Agent maintains persistent connection with exponential backoff recovery." },
  { title: "Private End-to-End", desc: "Your traffic stays on your infrastructure. No third-party servers involved." },
];
---

<BaseLayout
  title="Octoporty - Self-hosted reverse proxy tunneling"
  description="Expose internal services through a public endpoint. Self-hosted alternative to ngrok with automatic HTTPS and web management."
>
  <section id="top" class="mb-10 md:mb-16">
    <div class="mb-4 flex items-center gap-2 pt-24">
      <a
        href="/changelog"
        class="inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm font-medium text-red-800 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 dark:hover:bg-red-900/50"
      >
        v0.9.18
      </a>
      <a
        href="https://github.com/aduggleby/octoporty"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center rounded-full bg-zinc-100 px-3 py-1 text-sm font-medium text-zinc-700 hover:bg-zinc-200 dark:bg-zinc-800 dark:text-zinc-300 dark:hover:bg-zinc-700"
      >
        <svg class="mr-1.5 h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
        </svg>
        GitHub
      </a>
    </div>
    <h1 class="mb-4 max-w-4xl text-3xl font-bold text-zinc-900 sm:mb-6 sm:text-8xl dark:text-white">
      Expose internal services securely
    </h1>
    <blockquote
      class="mb-18 border-l-2 border-zinc-200 pl-4 text-sm text-zinc-400 italic dark:border-zinc-700 dark:text-zinc-500"
    >
      Self-hosted reverse proxy tunneling - like ngrok, but yours.
    </blockquote>
    <p class="mb-8 font-serif text-zinc-600 sm:text-3xl dark:text-zinc-400">
      Octoporty creates secure tunnels from your private network to the public internet. Deploy the Gateway on a cloud server, run the Agent behind your firewall, and expose any internal service with automatic HTTPS.
    </p>
  </section>

  <section id="architecture" class="mb-10 md:mb-16">
    <h2 class="mb-2 text-xl font-bold text-zinc-900 sm:text-2xl dark:text-white">How it works</h2>
    <p class="mb-4 text-zinc-500 sm:mb-6 dark:text-zinc-400">
      Traffic flows through your Gateway server and is tunneled to services in your private network.
    </p>

    <div class="overflow-x-auto rounded-xl border border-zinc-200 bg-zinc-50 p-4 sm:p-6 dark:border-zinc-700 dark:bg-zinc-900">
      <pre class="diagram text-zinc-700 dark:text-zinc-300">{`
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                  INTERNET                                       │
│                                                                                 │
│    Users access: app.yourdomain.com, api.yourdomain.com, etc.                   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        CLOUD SERVER (Public IP)                                 │
│  ┌──────────────────────────────────────────────────────────────────────────┐   │
│  │                              Caddy                                        │  │
│  │                     (Reverse Proxy + Auto HTTPS)                          │  │
│  │                         Ports: 80, 443                                    │  │
│  └──────────────────────────────────────────────────────────────────────────┘   │
│                                       │                                         │
│                                       ▼                                         │
│  ┌──────────────────────────────────────────────────────────────────────────┐   │
│  │                        Octoporty Gateway                                  │  │
│  │                     (WebSocket Connection Hub)                            │  │
│  │                          Port: 17200                                      │  │
│  └──────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       │  WebSocket Tunnel
                                       │  (MessagePack + Lz4)
                                       │
                           ┌───────────┴───────────┐
                           │       FIREWALL        │
                           └───────────┬───────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          PRIVATE NETWORK                                        │
│  ┌──────────────────────────────────────────────────────────────────────────┐   │
│  │                         Octoporty Agent                                   │  │
│  │              (Tunnel Client + Web Management UI)                          │  │
│  │                          Port: 17201                                      │  │
│  └──────────────────────────────────────────────────────────────────────────┘   │
│                                       │                                         │
│              ┌────────────────────────┼────────────────────────┐                │
│              │                        │                        │                │
│              ▼                        ▼                        ▼                │
│  ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐          │
│  │    Web App        │   │      API          │   │    Database       │          │
│  │  localhost:3000   │   │  localhost:8080   │   │  localhost:5432   │          │
│  └───────────────────┘   └───────────────────┘   └───────────────────┘          │
└─────────────────────────────────────────────────────────────────────────────────┘
      `}</pre>
    </div>
  </section>

  <section id="features" class="mb-10 md:mb-16">
    <h2 class="mb-2 text-xl font-bold text-zinc-900 sm:text-2xl dark:text-white">Features</h2>
    <p class="mb-4 text-zinc-500 sm:mb-6 dark:text-zinc-400">Everything you need to securely expose internal services.</p>
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {
        features.map((feature) => (
          <div class="rounded-xl border border-zinc-200 bg-zinc-50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50">
            <h3 class="mb-1 font-semibold text-zinc-900 dark:text-white">{feature.title}</h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-400">{feature.desc}</p>
          </div>
        ))
      }
    </div>
  </section>

  <section id="getting-started" class="mb-10 md:mb-16">
    <h2 class="mb-2 text-xl font-bold text-zinc-900 sm:text-2xl dark:text-white">Getting started</h2>
    <p class="mb-4 text-zinc-500 sm:mb-6 dark:text-zinc-400">
      Deploy in two steps: Gateway on your cloud server, Agent in your private network.
    </p>

    <div class="mb-6">
      <h3 class="mb-3 text-lg font-semibold text-zinc-800 dark:text-zinc-200">Step 1: Install Gateway (Cloud Server)</h3>
      <CodeBlock code={quickStartGateway} lang="bash" filename="gateway-server" />
    </div>

    <div class="mb-6">
      <h3 class="mb-3 text-lg font-semibold text-zinc-800 dark:text-zinc-200">Step 2: Install Agent (Private Network)</h3>
      <CodeBlock code={quickStartAgent} lang="bash" filename="agent-server" />
    </div>

    <p class="text-sm text-zinc-500 dark:text-zinc-400">
      Once both are running, access the Agent web UI at <code class="rounded bg-zinc-100 px-1.5 py-0.5 text-red-600 dark:bg-zinc-800 dark:text-red-400">http://your-agent:17201</code> to configure port mappings.
    </p>

    <div class="mt-6 rounded-lg border border-zinc-200 bg-zinc-50 p-4 dark:border-zinc-700 dark:bg-zinc-800/50">
      <h4 class="mb-2 font-semibold text-zinc-900 dark:text-white">Platform Guides</h4>
      <p class="text-sm text-zinc-600 dark:text-zinc-400">
        Running on specific platforms? Check out our detailed guides:
      </p>
      <ul class="mt-2 space-y-1 text-sm">
        <li>
          <a href="/truenas" class="text-red-600 hover:underline dark:text-red-400">TrueNAS Scale Installation Guide</a>
        </li>
      </ul>
    </div>
  </section>

  <section id="update" class="mb-10 md:mb-16">
    <h2 class="mb-2 text-xl font-bold text-zinc-900 sm:text-2xl dark:text-white">Updating</h2>
    <p class="mb-4 text-zinc-500 sm:mb-6 dark:text-zinc-400">
      Update to the latest version with a single command.
    </p>

    <div class="overflow-x-auto">
      <table class="w-full min-w-[400px] text-sm">
        <thead>
          <tr class="border-b border-zinc-200 dark:border-zinc-700">
            <th class="px-3 py-3 text-left text-xs font-semibold tracking-wider text-zinc-400 uppercase">Component</th>
            <th class="px-3 py-3 text-left text-xs font-semibold tracking-wider text-zinc-400 uppercase">Update Command</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-zinc-100 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-800/50">
            <td class="px-3 py-3 font-medium text-zinc-900 dark:text-white">Gateway</td>
            <td class="px-3 py-3">
              <code class="rounded bg-zinc-100 px-1.5 py-0.5 text-red-600 dark:bg-zinc-800 dark:text-red-400">
                curl -fsSL https://octoporty.com/update-gateway.sh | bash
              </code>
            </td>
          </tr>
          <tr class="border-b border-zinc-100 hover:bg-zinc-50 dark:border-zinc-800 dark:hover:bg-zinc-800/50">
            <td class="px-3 py-3 font-medium text-zinc-900 dark:text-white">Agent</td>
            <td class="px-3 py-3">
              <code class="rounded bg-zinc-100 px-1.5 py-0.5 text-red-600 dark:bg-zinc-800 dark:text-red-400">
                curl -fsSL https://octoporty.com/update-agent.sh | bash
              </code>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <p class="mt-3 text-sm text-zinc-400 dark:text-zinc-500">
      See the <a href="https://github.com/aduggleby/octoporty#updating" target="_blank" rel="noopener noreferrer" class="text-red-600 hover:underline dark:text-red-400">README</a> for detailed update instructions and migration guides.
    </p>
  </section>

  <section id="links" class="mb-10 md:mb-16">
    <h2 class="mb-2 text-xl font-bold text-zinc-900 sm:text-2xl dark:text-white">Resources</h2>
    <p class="mb-4 text-zinc-500 sm:mb-6 dark:text-zinc-400">Documentation, source code, and container images.</p>

    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <a
        href="https://github.com/aduggleby/octoporty"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 rounded-xl border border-zinc-200 bg-zinc-50 p-4 transition-colors hover:border-red-300 hover:bg-red-50 dark:border-zinc-700 dark:bg-zinc-800/50 dark:hover:border-red-700 dark:hover:bg-red-900/20"
      >
        <svg class="h-8 w-8 text-zinc-700 dark:text-zinc-300" fill="currentColor" viewBox="0 0 24 24">
          <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
        </svg>
        <div>
          <div class="font-semibold text-zinc-900 dark:text-white">GitHub Repository</div>
          <div class="text-sm text-zinc-500 dark:text-zinc-400">Source code & documentation</div>
        </div>
      </a>
      <a
        href="https://ghcr.io/aduggleby/octoporty-gateway"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 rounded-xl border border-zinc-200 bg-zinc-50 p-4 transition-colors hover:border-red-300 hover:bg-red-50 dark:border-zinc-700 dark:bg-zinc-800/50 dark:hover:border-red-700 dark:hover:bg-red-900/20"
      >
        <svg class="h-8 w-8 text-zinc-700 dark:text-zinc-300" fill="currentColor" viewBox="0 0 24 24">
          <path d="M4.5 3A1.5 1.5 0 003 4.5v15A1.5 1.5 0 004.5 21h15a1.5 1.5 0 001.5-1.5v-15A1.5 1.5 0 0019.5 3h-15zM8 7a1 1 0 012 0v10a1 1 0 01-2 0V7zm6 0a1 1 0 012 0v10a1 1 0 01-2 0V7z" />
        </svg>
        <div>
          <div class="font-semibold text-zinc-900 dark:text-white">Gateway Image</div>
          <div class="text-sm text-zinc-500 dark:text-zinc-400">ghcr.io/aduggleby/octoporty-gateway</div>
        </div>
      </a>
      <a
        href="https://ghcr.io/aduggleby/octoporty-agent"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 rounded-xl border border-zinc-200 bg-zinc-50 p-4 transition-colors hover:border-red-300 hover:bg-red-50 dark:border-zinc-700 dark:bg-zinc-800/50 dark:hover:border-red-700 dark:hover:bg-red-900/20"
      >
        <svg class="h-8 w-8 text-zinc-700 dark:text-zinc-300" fill="currentColor" viewBox="0 0 24 24">
          <path d="M4.5 3A1.5 1.5 0 003 4.5v15A1.5 1.5 0 004.5 21h15a1.5 1.5 0 001.5-1.5v-15A1.5 1.5 0 0019.5 3h-15zM8 7a1 1 0 012 0v10a1 1 0 01-2 0V7zm6 0a1 1 0 012 0v10a1 1 0 01-2 0V7z" />
        </svg>
        <div>
          <div class="font-semibold text-zinc-900 dark:text-white">Agent Image</div>
          <div class="text-sm text-zinc-500 dark:text-zinc-400">ghcr.io/aduggleby/octoporty-agent</div>
        </div>
      </a>
    </div>
  </section>
</BaseLayout>
